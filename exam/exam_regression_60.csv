qid,difficulty,question,evidence,gold_sql,expected_tables,expected_columns,tags,template_id
Q0001,challenging,Compare effective vs statutory tax rate by jurisdiction for corporate division div_20.,Use corp_tax_provisions; compare effective_rate to statutory_rate.,"  SELECT jurisdiction, tax_type,
         ROUND(AVG(effective_rate), 4) AS avg_effective_rate,
         ROUND(AVG(statutory_rate), 4) AS avg_statutory_rate,
         ROUND(AVG(statutory_rate - effective_rate), 4) AS avg_rate_gap,
         SUM(current_provision + deferred_provision) AS total_provision
  FROM div_20.corp_tax_provisions
  GROUP BY jurisdiction, tax_type
  ORDER BY total_provision DESC;",corp_tax_provisions,"corp_tax_provisions.jurisdiction,corp_tax_provisions.effective_rate,corp_tax_provisions.statutory_rate",corporate,corp_tax_effective_vs_statutory
Q0002,challenging,Inventory turns by product category for 2022.,Approximate turns using inventory_transactions quantity.,"  SELECT pc.name, SUM(it.quantity) AS total_moved
  FROM div_14.inventory_transactions it
  JOIN div_14.products p ON p.product_id = it.product_id
  JOIN div_14.product_categories pc ON pc.category_id = p.category_id
  WHERE EXTRACT(YEAR FROM it.transaction_date) = 2022
  GROUP BY pc.name
  ORDER BY total_moved DESC;","inventory_transactions,products,product_categories","inventory_transactions.quantity,inventory_transactions.transaction_date,product_categories.name",inventory,inventory_turns
Q0003,challenging,Work order count by decoded status in manufacturing division div_02.,Table is xx_mfg_wo with abbreviated columns: sts_cd for status. Join to lookup_codes domain='WO_STATUS'.,"  SELECT lc.meaning AS status, COUNT(*) AS wo_count
  FROM div_02.xx_mfg_wo wo
  JOIN div_02.lookup_codes lc ON lc.code = wo.sts_cd AND lc.domain = 'WO_STATUS'
  GROUP BY lc.meaning
  ORDER BY wo_count DESC;","xx_mfg_wo,lookup_codes","xx_mfg_wo.sts_cd,lookup_codes.meaning","manufacturing,dirty_naming,lookup",dirty_mfg_wo_status
Q0004,challenging,Average days from requisition to PO for 2022.,Join purchase_requisitions to purchase_orders by requisition_id.,"  SELECT ROUND(AVG(po.order_date - pr.request_date), 2) AS avg_days
  FROM div_12.purchase_requisitions pr
  JOIN div_12.purchase_orders po ON po.requisition_id = pr.requisition_id
  WHERE EXTRACT(YEAR FROM pr.request_date) = 2022;","purchase_requisitions,purchase_orders","purchase_requisitions.request_date,purchase_orders.order_date",procurement,procurement_cycle_time
Q0005,moderate,Count of statements of work by status for services division div_08.,Join svc_statements_of_work.status_code to lookup_codes domain='PROJECT_STATUS' for decoded names.,"  SELECT lc.meaning AS status, COUNT(*) AS sow_count
  FROM div_08.svc_statements_of_work sow
  JOIN div_08.lookup_codes lc ON lc.code = sow.status_code AND lc.domain = 'PROJECT_STATUS'
  GROUP BY lc.meaning
  ORDER BY sow_count DESC;","svc_statements_of_work,lookup_codes","svc_statements_of_work.status_code,lookup_codes.meaning","services,lookup",svc_sow_by_status
Q0006,challenging,Total contract value by customer for services division div_09.,"Table is zz_svc_sow with abbreviated columns: tot_amt for total amount, cust_nbr for customer ID. Join to customers.","  SELECT c.name, SUM(sow.tot_amt) AS total_value, COUNT(*) AS sow_count
  FROM div_09.zz_svc_sow sow
  JOIN div_09.customers c ON c.customer_id = sow.cust_nbr
  GROUP BY c.name
  ORDER BY total_value DESC
  LIMIT 10;","zz_svc_sow,customers","zz_svc_sow.tot_amt,zz_svc_sow.cust_nbr,customers.name","services,dirty_naming",dirty_svc_sow_value
Q0007,moderate,Total payroll net pay by pay period for 2022.,Payroll tables are payroll_run_hdr and payroll_run_line.,"  SELECT h.pay_period_start, h.pay_period_end, SUM(l.net_pay) AS total_net_pay
  FROM div_05.payroll_run_hdr h
  JOIN div_05.payroll_run_line l ON l.run_id = h.run_id
  WHERE EXTRACT(YEAR FROM h.pay_period_start) = 2022
  GROUP BY h.pay_period_start, h.pay_period_end
  ORDER BY h.pay_period_start;","payroll_run_hdr,payroll_run_line","payroll_run_hdr.pay_period_start,payroll_run_line.net_pay","hr,payroll",payroll_total
Q0008,challenging,Total POS sales by payment method for retail division div_12.,"Table is zz_pos_trnx with abbreviated columns: tot_amt, pay_mthd_cd, trnx_dt.","  SELECT pay_mthd_cd, COUNT(*) AS txn_count,
         SUM(tot_amt) AS total_sales
  FROM div_12.zz_pos_trnx
  GROUP BY pay_mthd_cd
  ORDER BY total_sales DESC;",zz_pos_trnx,"zz_pos_trnx.pay_mthd_cd,zz_pos_trnx.tot_amt","retail,dirty_naming",dirty_rtl_pos_sales
Q0009,moderate,Headcount by department for 2023.,Use employees.department_id.,"  SELECT d.name, COUNT(*) AS headcount
  FROM div_11.employees e
  JOIN div_11.departments d ON d.department_id = e.department_id
  WHERE EXTRACT(YEAR FROM e.hire_date) <= 2023
  GROUP BY d.name
  ORDER BY headcount DESC;","employees,departments",employees.department_id,hr,org_headcount
Q0010,moderate,What percentage of AR invoices were late in 2023?,Late invoices have status = 'late'.,"  SELECT
    ROUND(100.0 * SUM(CASE WHEN status = 'late' THEN 1 ELSE 0 END) / COUNT(*), 2) AS late_pct
  FROM div_15.finance_ar_invoices
  WHERE EXTRACT(YEAR FROM invoice_date) = 2023;",finance_ar_invoices,"finance_ar_invoices.status,finance_ar_invoices.invoice_date","finance,ar,rate",ar_late_rate
Q0011,moderate,FTE headcount by department for 2024.,FTE = full-time equivalent; count employees active during the year.,"  SELECT d.name AS department,
         COUNT(*) AS fte_count
  FROM div_02.employees e
  JOIN div_02.departments d ON d.department_id = e.department_id
  WHERE e.hire_date <= DATE '2024-12-31'
    AND (e.termination_date IS NULL OR e.termination_date > DATE '2024-01-01')
  GROUP BY d.name
  ORDER BY fte_count DESC;","employees,departments","employees.department_id,employees.hire_date","hr,jargon",fte_headcount
Q0012,simple,Show onboarding tasks overdue as of today.,Overdue if status not done and due_date < today.,"  SELECT task_id, employee_id, task_name, due_date, status
  FROM div_19.hr_onboarding_tasks
  WHERE status <> 'done'
    AND due_date < CURRENT_DATE;",hr_onboarding_tasks,"hr_onboarding_tasks.status,hr_onboarding_tasks.due_date",hr,onboarding_overdue
Q0013,moderate,Assets transferred between locations in 2022.,Use asset_transfers.transfer_date.,"  SELECT transfer_id, asset_id, from_location_id, to_location_id, transfer_date
  FROM div_20.asset_transfers
  WHERE EXTRACT(YEAR FROM transfer_date) = 2022;",asset_transfers,asset_transfers.transfer_date,assets,asset_transfer
Q0014,moderate,Billing milestones past due and not yet invoiced for services division div_10.,svc_billing_milestones where due_date < today and invoice_date IS NULL.,"  SELECT sow.sow_number, bm.description, bm.amount, bm.due_date
  FROM div_10.svc_billing_milestones bm
  JOIN div_10.svc_statements_of_work sow ON sow.sow_id = bm.sow_id
  WHERE bm.due_date < CURRENT_DATE AND bm.invoice_date IS NULL
  ORDER BY bm.due_date;","svc_billing_milestones,svc_statements_of_work","svc_billing_milestones.due_date,svc_billing_milestones.invoice_date,svc_billing_milestones.amount",services,svc_overdue_milestones
Q0015,moderate,High and critical priority work orders using lookup codes in div_05.,"Filter mfg_work_orders.priority_code via lookup_codes domain='PRIORITY' where meaning IN ('High','Critical').","  SELECT wo.work_order_id, wo.work_order_number, lc.meaning AS priority
  FROM div_05.mfg_work_orders wo
  JOIN div_05.lookup_codes lc ON lc.code = wo.priority_code AND lc.domain = 'PRIORITY'
  WHERE lc.meaning IN ('High', 'Critical');","mfg_work_orders,lookup_codes","mfg_work_orders.priority_code,lookup_codes.meaning","manufacturing,lookup",priority_filter_decoded
Q0016,moderate,Work order count by decoded status in manufacturing division div_03.,Join mfg_work_orders.status_code to lookup_codes where domain='WO_STATUS'.,"  SELECT lc.meaning AS status,
         COUNT(*) AS wo_count
  FROM div_03.mfg_work_orders wo
  JOIN div_03.lookup_codes lc ON lc.code = wo.status_code AND lc.domain = 'WO_STATUS'
  GROUP BY lc.meaning
  ORDER BY wo_count DESC;","mfg_work_orders,lookup_codes","mfg_work_orders.status_code,lookup_codes.meaning","manufacturing,lookup",wo_status_decoded
Q0017,moderate,Average days between vendor invoice date and due date by vendor.,Use vendor_invoices.invoice_date and due_date.,"  SELECT v.name, ROUND(AVG(vi.due_date - vi.invoice_date)::numeric, 2) AS avg_days
  FROM div_17.vendor_invoices vi
  JOIN div_17.vendors v ON v.vendor_id = vi.vendor_id
  GROUP BY v.name
  ORDER BY avg_days DESC;","vendor_invoices,vendors","vendor_invoices.invoice_date,vendor_invoices.due_date",procurement,vendor_invoice_aging
Q0018,simple,List inactive vendors.,Use vendors.is_active.,"  SELECT vendor_id, name
  FROM div_10.vendors
  WHERE is_active = FALSE;",vendors,vendors.is_active,procurement,vendor_active
Q0019,moderate,Sales order count by sales region for 2022.,Join sales_orders -> customers -> addresses -> cities -> states_provinces -> countries?,"  SELECT s.name AS state, COUNT(*) AS order_count
  FROM div_11.sales_orders so
  JOIN div_11.customers c ON c.customer_id = so.customer_id
  LEFT JOIN div_11.addresses a ON a.address_id = c.billing_address_id
  LEFT JOIN div_11.cities ci ON ci.city_id = a.city_id
  LEFT JOIN div_11.states_provinces s ON s.state_id = ci.state_id
  WHERE EXTRACT(YEAR FROM so.order_date) = 2022
  GROUP BY s.name
  ORDER BY order_count DESC;","sales_orders,customers,addresses,cities,states_provinces","sales_orders.order_date,customers.customer_id","sales,geography",sales_by_region
Q0020,challenging,Monthly AR invoice trend with running total for 2024.,Use window function SUM() OVER for running total.,"  SELECT
    DATE_TRUNC('month', invoice_date) AS month,
    SUM(amount) AS monthly_amount,
    SUM(SUM(amount)) OVER (ORDER BY DATE_TRUNC('month', invoice_date)) AS running_total
  FROM div_18.finance_ar_invoices
  WHERE EXTRACT(YEAR FROM invoice_date) = 2024
  GROUP BY month
  ORDER BY month;",finance_ar_invoices,"finance_ar_invoices.invoice_date,finance_ar_invoices.amount","finance,temporal,window",monthly_ar_trend
Q0021,moderate,Products below reorder minimum by warehouse.,Join reorder_rules to inventory_levels.,"  SELECT rr.warehouse_id, p.sku, il.quantity_on_hand, rr.min_quantity
  FROM div_04.reorder_rules rr
  JOIN div_04.inventory_levels il ON il.product_id = rr.product_id AND il.warehouse_id = rr.warehouse_id
  JOIN div_04.products p ON p.product_id = rr.product_id
  WHERE il.quantity_on_hand < rr.min_quantity;","reorder_rules,inventory_levels,products","reorder_rules.min_quantity,inventory_levels.quantity_on_hand",inventory,inventory_reorder
Q0022,simple,Vendors with payment terms of 45 days or more.,"Use vendors.payment_terms (integer, number of days).","  SELECT vendor_id, name, payment_terms
  FROM div_15.vendors
  WHERE payment_terms >= 45;",vendors,vendors.payment_terms,procurement,supplier_terms
Q0023,challenging,Procure-to-pay cycle: PO to receipt to invoice for each vendor in 2023.,Join purchase_orders -> goods_receipts -> vendor_invoices -> vendors.,"  SELECT v.name AS vendor,
         po.po_id,
         po.order_date,
         gr.receipt_id,
         gr.receipt_date,
         vi.invoice_id,
         vi.invoice_date,
         vi.total AS invoice_total
  FROM div_19.purchase_orders po
  JOIN div_19.goods_receipts gr ON gr.po_id = po.po_id
  JOIN div_19.vendor_invoices vi ON vi.po_id = po.po_id
  JOIN div_19.vendors v ON v.vendor_id = po.vendor_id
  WHERE EXTRACT(YEAR FROM po.order_date) = 2023
  ORDER BY po.order_date
  LIMIT 50;","purchase_orders,goods_receipts,vendor_invoices,vendors","purchase_orders.order_date,goods_receipts.receipt_date,vendor_invoices.invoice_date","procurement,multi_join",procure_to_pay_cycle
Q0024,simple,List inventory lots expiring within 60 days.,Use inventory_lots.expiration_date.,"  SELECT lot_id, lot_number, expiration_date
  FROM div_11.inventory_lots
  WHERE expiration_date <= CURRENT_DATE + INTERVAL '60 days';",inventory_lots,"inventory_lots.expiration_date,inventory_lots.lot_number",inventory,inventory_lot_expiring
Q0025,challenging,Revenue per FTE by department for 2022.,Revenue from sales; FTE from employee count. Join via sales_rep or department.,"  WITH dept_revenue AS (
    SELECT e.department_id,
           SUM(ol.quantity * ol.unit_price) AS revenue
    FROM div_16.order_lines ol
    JOIN div_16.sales_orders so ON so.order_id = ol.order_id
    JOIN div_16.employees e ON e.employee_id = so.sales_rep_id
    WHERE EXTRACT(YEAR FROM so.order_date) = 2022
    GROUP BY e.department_id
  ),
  dept_fte AS (
    SELECT department_id, COUNT(*) AS fte
    FROM div_16.employees
    WHERE hire_date <= DATE '2022-12-31'
      AND (termination_date IS NULL OR termination_date > DATE '2022-01-01')
    GROUP BY department_id
  )
  SELECT d.name,
         dr.revenue,
         df.fte,
         ROUND(dr.revenue / NULLIF(df.fte, 0), 2) AS revenue_per_fte
  FROM dept_revenue dr
  JOIN dept_fte df ON df.department_id = dr.department_id
  JOIN div_16.departments d ON d.department_id = dr.department_id
  ORDER BY revenue_per_fte DESC;","order_lines,sales_orders,employees,departments","order_lines.quantity,order_lines.unit_price,employees.department_id","sales,hr,jargon",revenue_per_fte
Q0026,moderate,Total maintenance cost by asset category in 2023.,Join asset_maintenance -> fixed_assets -> asset_categories.,"  SELECT ac.name, SUM(am.cost) AS total_cost
  FROM div_04.asset_maintenance am
  JOIN div_04.fixed_assets fa ON fa.asset_id = am.asset_id
  JOIN div_04.asset_categories ac ON ac.category_id = fa.category_id
  WHERE EXTRACT(YEAR FROM am.scheduled_date) = 2023
  GROUP BY ac.name;","asset_maintenance,fixed_assets,asset_categories","asset_maintenance.cost,asset_categories.name",assets,asset_maintenance_costs
Q0027,challenging,"Aged AR receivables buckets (0-30, 31-60, 61-90, 90+) for 2023.",Use finance_ar_invoices with status='open'; age = CURRENT_DATE - due_date.,"  SELECT
    CASE
      WHEN CURRENT_DATE - due_date <= 30 THEN '0-30'
      WHEN CURRENT_DATE - due_date <= 60 THEN '31-60'
      WHEN CURRENT_DATE - due_date <= 90 THEN '61-90'
      ELSE '90+'
    END AS aging_bucket,
    COUNT(*) AS invoice_count,
    SUM(amount) AS total_amount
  FROM div_03.finance_ar_invoices
  WHERE status = 'open'
    AND EXTRACT(YEAR FROM invoice_date) = 2023
  GROUP BY aging_bucket
  ORDER BY aging_bucket;",finance_ar_invoices,"finance_ar_invoices.due_date,finance_ar_invoices.amount,finance_ar_invoices.status","finance,ar,aging",aged_ar_receivables
Q0028,challenging,Average days from RFQ to vendor response for 2024.,Join procurement_rfqs to procurement_rfq_responses.,"  SELECT ROUND(AVG(r.response_date - q.rfq_date), 2) AS avg_days
  FROM div_17.procurement_rfqs q
  JOIN div_17.procurement_rfq_responses r ON r.rfq_id = q.rfq_id
  WHERE EXTRACT(YEAR FROM q.rfq_date) = 2024;","procurement_rfqs,procurement_rfq_responses","procurement_rfqs.rfq_date,procurement_rfq_responses.response_date","procurement,time",rfq_response_time
Q0029,challenging,"Aged AR receivables buckets (0-30, 31-60, 61-90, 90+) for 2021.",Use finance_ar_invoices with status='open'; age = CURRENT_DATE - due_date.,"  SELECT
    CASE
      WHEN CURRENT_DATE - due_date <= 30 THEN '0-30'
      WHEN CURRENT_DATE - due_date <= 60 THEN '31-60'
      WHEN CURRENT_DATE - due_date <= 90 THEN '61-90'
      ELSE '90+'
    END AS aging_bucket,
    COUNT(*) AS invoice_count,
    SUM(amount) AS total_amount
  FROM div_16.finance_ar_invoices
  WHERE status = 'open'
    AND EXTRACT(YEAR FROM invoice_date) = 2021
  GROUP BY aging_bucket
  ORDER BY aging_bucket;",finance_ar_invoices,"finance_ar_invoices.due_date,finance_ar_invoices.amount,finance_ar_invoices.status","finance,ar,aging",aged_ar_receivables
Q0030,moderate,Total payroll net pay by pay period for 2021.,Payroll tables are payroll_run_hdr and payroll_run_line.,"  SELECT h.pay_period_start, h.pay_period_end, SUM(l.net_pay) AS total_net_pay
  FROM div_08.payroll_run_hdr h
  JOIN div_08.payroll_run_line l ON l.run_id = h.run_id
  WHERE EXTRACT(YEAR FROM h.pay_period_start) = 2021
  GROUP BY h.pay_period_start, h.pay_period_end
  ORDER BY h.pay_period_start;","payroll_run_hdr,payroll_run_line","payroll_run_hdr.pay_period_start,payroll_run_line.net_pay","hr,payroll",payroll_total
Q0031,challenging,Work order count by decoded status in manufacturing division div_04.,Table is xx_mfg_wo with abbreviated columns: sts_cd for status. Join to lookup_codes domain='WO_STATUS'.,"  SELECT lc.meaning AS status, COUNT(*) AS wo_count
  FROM div_04.xx_mfg_wo wo
  JOIN div_04.lookup_codes lc ON lc.code = wo.sts_cd AND lc.domain = 'WO_STATUS'
  GROUP BY lc.meaning
  ORDER BY wo_count DESC;","xx_mfg_wo,lookup_codes","xx_mfg_wo.sts_cd,lookup_codes.meaning","manufacturing,dirty_naming,lookup",dirty_mfg_wo_status
Q0032,moderate,Average discount percentage on sales order lines in 2024.,discount is in order_lines.discount_percent.,"  SELECT ROUND(AVG(ol.discount_percent), 2) AS avg_discount
  FROM div_11.order_lines ol
  JOIN div_11.sales_orders so ON so.order_id = ol.order_id
  WHERE EXTRACT(YEAR FROM so.order_date) = 2024;","order_lines,sales_orders","order_lines.discount_percent,sales_orders.order_date",sales,sales_order_discount
Q0033,challenging,Net intercompany balance between divisions for corporate division div_16.,Use corp_intercompany_txns; net = sum sent - sum received per division pair.,"  SELECT from_division, to_division,
         SUM(amount) AS total_transferred,
         COUNT(*) AS txn_count
  FROM div_16.corp_intercompany_txns
  WHERE status_code = 'AP'
  GROUP BY from_division, to_division
  ORDER BY total_transferred DESC;",corp_intercompany_txns,"corp_intercompany_txns.from_division,corp_intercompany_txns.to_division,corp_intercompany_txns.amount",corporate,corp_intercompany_balance
Q0034,simple,List open sales opportunities with probability over 0.6.,Use sales_opportunities.probability.,"  SELECT opportunity_id, name, amount, probability
  FROM div_09.sales_opportunities
  WHERE probability > 0.6;",sales_opportunities,sales_opportunities.probability,sales,open_opportunities
Q0035,challenging,Average days from requisition to PO for 2023.,Join purchase_requisitions to purchase_orders by requisition_id.,"  SELECT ROUND(AVG(po.order_date - pr.request_date), 2) AS avg_days
  FROM div_12.purchase_requisitions pr
  JOIN div_12.purchase_orders po ON po.requisition_id = pr.requisition_id
  WHERE EXTRACT(YEAR FROM pr.request_date) = 2023;","purchase_requisitions,purchase_orders","purchase_requisitions.request_date,purchase_orders.order_date",procurement,procurement_cycle_time
Q0036,simple,Primary contacts for all customers.,Join customers to customer_contacts where is_primary = TRUE.,"  SELECT c.name AS customer, cc.first_name || ' ' || cc.last_name AS contact, cc.email
  FROM div_11.customers c
  JOIN div_11.customer_contacts cc ON cc.customer_id = c.customer_id
  WHERE cc.is_primary = TRUE
  ORDER BY c.name;","customers,customer_contacts","customer_contacts.is_primary,customer_contacts.first_name,customer_contacts.last_name",sales,customer_contact_primary
Q0037,challenging,"Employee tenure distribution (0-1yr, 1-3yr, 3-5yr, 5+yr) as of 2021.",Tenure = hire_date to end of year; bucket by years.,"  SELECT
    CASE
      WHEN EXTRACT(YEAR FROM AGE(DATE '2021-12-31', hire_date)) < 1 THEN '0-1 yr'
      WHEN EXTRACT(YEAR FROM AGE(DATE '2021-12-31', hire_date)) < 3 THEN '1-3 yr'
      WHEN EXTRACT(YEAR FROM AGE(DATE '2021-12-31', hire_date)) < 5 THEN '3-5 yr'
      ELSE '5+ yr'
    END AS tenure_bucket,
    COUNT(*) AS employee_count
  FROM div_02.employees
  WHERE hire_date <= DATE '2021-12-31'
    AND (termination_date IS NULL OR termination_date > DATE '2021-12-31')
  GROUP BY tenure_bucket
  ORDER BY tenure_bucket;",employees,employees.hire_date,"hr,temporal",employee_tenure_distribution
Q0038,moderate,Count of statements of work by status for services division div_10.,Join svc_statements_of_work.status_code to lookup_codes domain='PROJECT_STATUS' for decoded names.,"  SELECT lc.meaning AS status, COUNT(*) AS sow_count
  FROM div_10.svc_statements_of_work sow
  JOIN div_10.lookup_codes lc ON lc.code = sow.status_code AND lc.domain = 'PROJECT_STATUS'
  GROUP BY lc.meaning
  ORDER BY sow_count DESC;","svc_statements_of_work,lookup_codes","svc_statements_of_work.status_code,lookup_codes.meaning","services,lookup",svc_sow_by_status
Q0039,moderate,Headcount by department for 2024.,Use employees.department_id.,"  SELECT d.name, COUNT(*) AS headcount
  FROM div_16.employees e
  JOIN div_16.departments d ON d.department_id = e.department_id
  WHERE EXTRACT(YEAR FROM e.hire_date) <= 2024
  GROUP BY d.name
  ORDER BY headcount DESC;","employees,departments",employees.department_id,hr,org_headcount
Q0040,moderate,Work order count by decoded status in manufacturing division div_01.,Join mfg_work_orders.status_code to lookup_codes where domain='WO_STATUS'.,"  SELECT lc.meaning AS status,
         COUNT(*) AS wo_count
  FROM div_01.mfg_work_orders wo
  JOIN div_01.lookup_codes lc ON lc.code = wo.status_code AND lc.domain = 'WO_STATUS'
  GROUP BY lc.meaning
  ORDER BY wo_count DESC;","mfg_work_orders,lookup_codes","mfg_work_orders.status_code,lookup_codes.meaning","manufacturing,lookup",wo_status_decoded
Q0041,challenging,Employee turnover rate for 2023.,Turnover = terminations / average headcount.,"  WITH terminations AS (
    SELECT COUNT(*) AS term_count
    FROM div_06.employees
    WHERE EXTRACT(YEAR FROM termination_date) = 2023
  ),
  headcount AS (
    SELECT COUNT(*) AS headcount
    FROM div_06.employees
    WHERE hire_date <= DATE '2023-12-31'
      AND (termination_date IS NULL OR termination_date > DATE '2023-01-01')
  )
  SELECT ROUND(100.0 * t.term_count / NULLIF(h.headcount,0), 2) AS turnover_pct
  FROM terminations t, headcount h;",employees,"employees.termination_date,employees.hire_date",hr,employee_turnover
Q0042,challenging,Inventory turns by product category for 2021.,Approximate turns using inventory_transactions quantity.,"  SELECT pc.name, SUM(it.quantity) AS total_moved
  FROM div_07.inventory_transactions it
  JOIN div_07.products p ON p.product_id = it.product_id
  JOIN div_07.product_categories pc ON pc.category_id = p.category_id
  WHERE EXTRACT(YEAR FROM it.transaction_date) = 2021
  GROUP BY pc.name
  ORDER BY total_moved DESC;","inventory_transactions,products,product_categories","inventory_transactions.quantity,inventory_transactions.transaction_date,product_categories.name",inventory,inventory_turns
Q0043,moderate,High and critical priority work orders using lookup codes in div_01.,"Filter mfg_work_orders.priority_code via lookup_codes domain='PRIORITY' where meaning IN ('High','Critical').","  SELECT wo.work_order_id, wo.work_order_number, lc.meaning AS priority
  FROM div_01.mfg_work_orders wo
  JOIN div_01.lookup_codes lc ON lc.code = wo.priority_code AND lc.domain = 'PRIORITY'
  WHERE lc.meaning IN ('High', 'Critical');","mfg_work_orders,lookup_codes","mfg_work_orders.priority_code,lookup_codes.meaning","manufacturing,lookup",priority_filter_decoded
Q0044,challenging,Compare effective vs statutory tax rate by jurisdiction for corporate division div_19.,Use corp_tax_provisions; compare effective_rate to statutory_rate.,"  SELECT jurisdiction, tax_type,
         ROUND(AVG(effective_rate), 4) AS avg_effective_rate,
         ROUND(AVG(statutory_rate), 4) AS avg_statutory_rate,
         ROUND(AVG(statutory_rate - effective_rate), 4) AS avg_rate_gap,
         SUM(current_provision + deferred_provision) AS total_provision
  FROM div_19.corp_tax_provisions
  GROUP BY jurisdiction, tax_type
  ORDER BY total_provision DESC;",corp_tax_provisions,"corp_tax_provisions.jurisdiction,corp_tax_provisions.effective_rate,corp_tax_provisions.statutory_rate",corporate,corp_tax_effective_vs_statutory
Q0045,challenging,Average resource allocation percent by role for active SOWs in services division div_10.,Join svc_resource_plan to svc_statements_of_work; filter active SOWs (status_code='AC').,"  SELECT rp.role_name,
         ROUND(AVG(rp.allocation_percent), 1) AS avg_allocation,
         COUNT(*) AS assignments
  FROM div_10.svc_resource_plan rp
  JOIN div_10.svc_statements_of_work sow ON sow.sow_id = rp.sow_id
  WHERE sow.status_code = 'AC'
  GROUP BY rp.role_name
  ORDER BY avg_allocation DESC;","svc_resource_plan,svc_statements_of_work","svc_resource_plan.role_name,svc_resource_plan.allocation_percent,svc_statements_of_work.status_code","services,kpi",svc_resource_utilization
Q0046,moderate,Open audit findings by severity and type for corporate division div_19.,"Use corp_audit_findings where status_code IN ('OP','IP').","  SELECT audit_type, severity, COUNT(*) AS finding_count
  FROM div_19.corp_audit_findings
  WHERE status_code IN ('OP', 'IP')
  GROUP BY audit_type, severity
  ORDER BY severity, finding_count DESC;",corp_audit_findings,"corp_audit_findings.severity,corp_audit_findings.audit_type,corp_audit_findings.status_code",corporate,corp_audit_findings_open
Q0047,moderate,Sales order count by sales region for 2023.,Join sales_orders -> customers -> addresses -> cities -> states_provinces -> countries?,"  SELECT s.name AS state, COUNT(*) AS order_count
  FROM div_09.sales_orders so
  JOIN div_09.customers c ON c.customer_id = so.customer_id
  LEFT JOIN div_09.addresses a ON a.address_id = c.billing_address_id
  LEFT JOIN div_09.cities ci ON ci.city_id = a.city_id
  LEFT JOIN div_09.states_provinces s ON s.state_id = ci.state_id
  WHERE EXTRACT(YEAR FROM so.order_date) = 2023
  GROUP BY s.name
  ORDER BY order_count DESC;","sales_orders,customers,addresses,cities,states_provinces","sales_orders.order_date,customers.customer_id","sales,geography",sales_by_region
Q0048,moderate,Top 10 customers by total sales amount in 2021?,Use order date; 'total sales' = sum(order_lines.quantity * order_lines.unit_price).,"  SELECT c.name, SUM(ol.quantity * ol.unit_price) AS total_sales
  FROM div_03.sales_orders so
  JOIN div_03.order_lines ol ON ol.order_id = so.order_id
  JOIN div_03.customers c ON c.customer_id = so.customer_id
  WHERE EXTRACT(YEAR FROM so.order_date) = 2021
  GROUP BY c.name
  ORDER BY total_sales DESC
  LIMIT 10;","sales_orders,order_lines,customers","sales_orders.order_date,order_lines.quantity,order_lines.unit_price,customers.name","sales,top_n,aggregation",sales_top_customers
Q0049,challenging,Departments where actual expenses exceed budget in 2021.,Compare project_expenses vs budgets by department.,"  SELECT d.name, b.total_amount, COALESCE(SUM(pe.amount),0) AS actual_spend
  FROM div_02.budgets b
  JOIN div_02.departments d ON d.department_id = b.department_id
  LEFT JOIN div_02.project_expenses pe ON pe.project_id IS NOT NULL
  WHERE EXTRACT(YEAR FROM b.created_at) = 2021
  GROUP BY d.name, b.total_amount
  HAVING COALESCE(SUM(pe.amount),0) > b.total_amount;","budgets,budget_lines,project_expenses,departments","budgets.total_amount,project_expenses.amount","finance,projects",budget_vs_actual
Q0050,challenging,Total contract value by customer for services division div_09.,"Table is zz_svc_sow with abbreviated columns: tot_amt for total amount, cust_nbr for customer ID. Join to customers.","  SELECT c.name, SUM(sow.tot_amt) AS total_value, COUNT(*) AS sow_count
  FROM div_09.zz_svc_sow sow
  JOIN div_09.customers c ON c.customer_id = sow.cust_nbr
  GROUP BY c.name
  ORDER BY total_value DESC
  LIMIT 10;","zz_svc_sow,customers","zz_svc_sow.tot_amt,zz_svc_sow.cust_nbr,customers.name","services,dirty_naming",dirty_svc_sow_value
Q0051,challenging,Departments where actual expenses exceed budget in 2022.,Compare project_expenses vs budgets by department.,"  SELECT d.name, b.total_amount, COALESCE(SUM(pe.amount),0) AS actual_spend
  FROM div_20.budgets b
  JOIN div_20.departments d ON d.department_id = b.department_id
  LEFT JOIN div_20.project_expenses pe ON pe.project_id IS NOT NULL
  WHERE EXTRACT(YEAR FROM b.created_at) = 2022
  GROUP BY d.name, b.total_amount
  HAVING COALESCE(SUM(pe.amount),0) > b.total_amount;","budgets,budget_lines,project_expenses,departments","budgets.total_amount,project_expenses.amount","finance,projects",budget_vs_actual
Q0052,challenging,Total contract value by customer for services division div_07.,"Table is zz_svc_sow with abbreviated columns: tot_amt for total amount, cust_nbr for customer ID. Join to customers.","  SELECT c.name, SUM(sow.tot_amt) AS total_value, COUNT(*) AS sow_count
  FROM div_07.zz_svc_sow sow
  JOIN div_07.customers c ON c.customer_id = sow.cust_nbr
  GROUP BY c.name
  ORDER BY total_value DESC
  LIMIT 10;","zz_svc_sow,customers","zz_svc_sow.tot_amt,zz_svc_sow.cust_nbr,customers.name","services,dirty_naming",dirty_svc_sow_value
Q0053,moderate,Count of statements of work by status for services division div_08.,Join svc_statements_of_work.status_code to lookup_codes domain='PROJECT_STATUS' for decoded names.,"  SELECT lc.meaning AS status, COUNT(*) AS sow_count
  FROM div_08.svc_statements_of_work sow
  JOIN div_08.lookup_codes lc ON lc.code = sow.status_code AND lc.domain = 'PROJECT_STATUS'
  GROUP BY lc.meaning
  ORDER BY sow_count DESC;","svc_statements_of_work,lookup_codes","svc_statements_of_work.status_code,lookup_codes.meaning","services,lookup",svc_sow_by_status
Q0054,moderate,Work order count by decoded status in manufacturing division div_05.,Join mfg_work_orders.status_code to lookup_codes where domain='WO_STATUS'.,"  SELECT lc.meaning AS status,
         COUNT(*) AS wo_count
  FROM div_05.mfg_work_orders wo
  JOIN div_05.lookup_codes lc ON lc.code = wo.status_code AND lc.domain = 'WO_STATUS'
  GROUP BY lc.meaning
  ORDER BY wo_count DESC;","mfg_work_orders,lookup_codes","mfg_work_orders.status_code,lookup_codes.meaning","manufacturing,lookup",wo_status_decoded
Q0055,challenging,Average time to close support cases in 2023.,Closed cases have status = 'closed'; use opened_at vs updated_at.,"  SELECT ROUND(AVG(EXTRACT(EPOCH FROM (updated_at - opened_at)) / 3600), 2) AS avg_close_hours
  FROM div_19.cust_srv_case
  WHERE status = 'closed'
    AND EXTRACT(YEAR FROM opened_at) = 2023;",cust_srv_case,"cust_srv_case.opened_at,cust_srv_case.updated_at",support,customer_service_sla
Q0056,challenging,Average resource allocation percent by role for active SOWs in services division div_08.,Join svc_resource_plan to svc_statements_of_work; filter active SOWs (status_code='AC').,"  SELECT rp.role_name,
         ROUND(AVG(rp.allocation_percent), 1) AS avg_allocation,
         COUNT(*) AS assignments
  FROM div_08.svc_resource_plan rp
  JOIN div_08.svc_statements_of_work sow ON sow.sow_id = rp.sow_id
  WHERE sow.status_code = 'AC'
  GROUP BY rp.role_name
  ORDER BY avg_allocation DESC;","svc_resource_plan,svc_statements_of_work","svc_resource_plan.role_name,svc_resource_plan.allocation_percent,svc_statements_of_work.status_code","services,kpi",svc_resource_utilization
Q0057,moderate,High and critical priority work orders using lookup codes in div_03.,"Filter mfg_work_orders.priority_code via lookup_codes domain='PRIORITY' where meaning IN ('High','Critical').","  SELECT wo.work_order_id, wo.work_order_number, lc.meaning AS priority
  FROM div_03.mfg_work_orders wo
  JOIN div_03.lookup_codes lc ON lc.code = wo.priority_code AND lc.domain = 'PRIORITY'
  WHERE lc.meaning IN ('High', 'Critical');","mfg_work_orders,lookup_codes","mfg_work_orders.priority_code,lookup_codes.meaning","manufacturing,lookup",priority_filter_decoded
Q0058,moderate,Assets transferred between locations in 2024.,Use asset_transfers.transfer_date.,"  SELECT transfer_id, asset_id, from_location_id, to_location_id, transfer_date
  FROM div_03.asset_transfers
  WHERE EXTRACT(YEAR FROM transfer_date) = 2024;",asset_transfers,asset_transfers.transfer_date,assets,asset_transfer
Q0059,challenging,Departments where actual expenses exceed budget in 2023.,Compare project_expenses vs budgets by department.,"  SELECT d.name, b.total_amount, COALESCE(SUM(pe.amount),0) AS actual_spend
  FROM div_10.budgets b
  JOIN div_10.departments d ON d.department_id = b.department_id
  LEFT JOIN div_10.project_expenses pe ON pe.project_id IS NOT NULL
  WHERE EXTRACT(YEAR FROM b.created_at) = 2023
  GROUP BY d.name, b.total_amount
  HAVING COALESCE(SUM(pe.amount),0) > b.total_amount;","budgets,budget_lines,project_expenses,departments","budgets.total_amount,project_expenses.amount","finance,projects",budget_vs_actual
Q0060,challenging,Procure-to-pay cycle: PO to receipt to invoice for each vendor in 2022.,Join purchase_orders -> goods_receipts -> vendor_invoices -> vendors.,"  SELECT v.name AS vendor,
         po.po_id,
         po.order_date,
         gr.receipt_id,
         gr.receipt_date,
         vi.invoice_id,
         vi.invoice_date,
         vi.total AS invoice_total
  FROM div_02.purchase_orders po
  JOIN div_02.goods_receipts gr ON gr.po_id = po.po_id
  JOIN div_02.vendor_invoices vi ON vi.po_id = po.po_id
  JOIN div_02.vendors v ON v.vendor_id = po.vendor_id
  WHERE EXTRACT(YEAR FROM po.order_date) = 2022
  ORDER BY po.order_date
  LIMIT 50;","purchase_orders,goods_receipts,vendor_invoices,vendors","purchase_orders.order_date,goods_receipts.receipt_date,vendor_invoices.invoice_date","procurement,multi_join",procure_to_pay_cycle
